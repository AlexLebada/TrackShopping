{'agent': {'messages': [AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_eznMiH2095oD2f4K9f8OxryO', 'function': {'arguments': '{}', 'name': 'querying_collections'}, 'type': 'function'}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 13, 'prompt_tokens': 700, 'total_tokens': 713, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-4o-mini-2024-07-18', 'system_fingerprint': 'fp_709714d124', 'finish_reason': 'tool_calls', 'logprobs': None}, id='run-8365dc15-1f8e-4457-ab06-8e11afad470a-0', tool_calls=[{'name': 'querying_collections', 'args': {}, 'id': 'call_eznMiH2095oD2f4K9f8OxryO', 'type': 'tool_call'}], usage_metadata={'input_tokens': 700, 'output_tokens': 13, 'total_tokens': 713, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}})]}}
----
{'tools': {'messages': [ToolMessage(content='["Collection list: ", [{"name": "users", "description": "Collection with user information.\\nHas the following keys, with values format and type:\\nuser: as str\\ninfo: details given like email etc, as str\\nscope: for what user wants to use this app, as str\\nregister_date: as str "}, {"name": "receipts", "description": "Collection with user\'s complete receipts, with main informations extracted.\\nHas the following keys, with values format and type:\\nuser: as str\\ndate(format: 2023-10-05): as str\\nfruits(product format:name-quantity-unit-price unit-total price), as a list of string with products \\nvegetables(same format and type as fruits)\\nshop_place: store/market where bought from, as str\\ndocument_id: id of the raw file from which this document has been extracted, as a string\\ntotal_cost: total amount of the receipt(includes also other products), as int"}, {"name": "non-receipts", "description": "Collection with user\'s incomplete receipts/other formats, with main informations extracted.\\nHas the following keys, with values format and type:\\nuser: as str\\ndate(format: 2023-10-05): as str\\nfruits(product format:name-quantity-unit-price unit-total price), as a list of string with products \\nvegetables(same format and type as fruits)\\nshop_place: store/market where bought from, as str\\ndocument_id: id of the raw file from which this document has been extracted, as a string\\ntotal_cost: total amount of the receipt(includes also other products), as int"}]]', name='querying_collections', id='f0680f5f-45a6-4ae1-b5eb-4c3b265f73a3', tool_call_id='call_eznMiH2095oD2f4K9f8OxryO')]}}
----
{'agent': {'messages': [AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_BwMFtpSh71y2uQzL2qITEYmx', 'function': {'arguments': '{"collection_name": "receipts", "description": "Retrieve total spending on fruits from complete receipts", "request": "total spending on fruits"}', 'name': 'agentic_retriever_data'}, 'type': 'function'}, {'id': 'call_WrgOt7EVteMgTpGOB8wpk95x', 'function': {'arguments': '{"collection_name": "non-receipts", "description": "Retrieve total spending on fruits from incomplete receipts", "request": "total spending on fruits"}', 'name': 'agentic_retriever_data'}, 'type': 'function'}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 95, 'prompt_tokens': 1078, 'total_tokens': 1173, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-4o-mini-2024-07-18', 'system_fingerprint': 'fp_709714d124', 'finish_reason': 'tool_calls', 'logprobs': None}, id='run-f11ae084-d5e2-4be1-88f7-8f4ba1a164b9-0', tool_calls=[{'name': 'agentic_retriever_data', 'args': {'collection_name': 'receipts', 'description': 'Retrieve total spending on fruits from complete receipts', 'request': 'total spending on fruits'}, 'id': 'call_BwMFtpSh71y2uQzL2qITEYmx', 'type': 'tool_call'}, {'name': 'agentic_retriever_data', 'args': {'collection_name': 'non-receipts', 'description': 'Retrieve total spending on fruits from incomplete receipts', 'request': 'total spending on fruits'}, 'id': 'call_WrgOt7EVteMgTpGOB8wpk95x', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1078, 'output_tokens': 95, 'total_tokens': 1173, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}})]}}
----
{'tools': {'messages': [ToolMessage(content='Error: OutputParserException(\'Failed to parse FindQueryFormat from completion {"collection": "receipts", "filter_query": {"items.description": {"$regex": "fruits", "$options": "i"}}, "projection": {"totalSpendingOnFruits": {"$sum": "$amount"}}}. Got: 1 validation error for FindQueryFormat\\nprojection.totalSpendingOnFruits\\n  Input should be a valid integer [type=int_type, input_value={\\\'$sum\\\': \\\'$amount\\\'}, input_type=dict]\\n    For further information visit https://errors.pydantic.dev/2.10/v/int_type\\nFor troubleshooting, visit: https://python.langchain.com/docs/troubleshooting/errors/OUTPUT_PARSING_FAILURE \')\n Please fix your mistakes.', name='agentic_retriever_data', id='d1d7b333-1e47-47a3-bfee-0f20f4708d98', tool_call_id='call_BwMFtpSh71y2uQzL2qITEYmx', status='error'), ToolMessage(content='Error: OutputParserException(\'Failed to parse FindQueryFormat from completion {"collection": "non-receipts", "filter_query": {"items": {"$elemMatch": {"category": "fruits"}}}, "projection": {"total_spending": {"$sum": "$amount"}}}. Got: 1 validation error for FindQueryFormat\\nprojection.total_spending\\n  Input should be a valid integer [type=int_type, input_value={\\\'$sum\\\': \\\'$amount\\\'}, input_type=dict]\\n    For further information visit https://errors.pydantic.dev/2.10/v/int_type\\nFor troubleshooting, visit: https://python.langchain.com/docs/troubleshooting/errors/OUTPUT_PARSING_FAILURE \')\n Please fix your mistakes.', name='agentic_retriever_data', id='2e6a682c-f1d7-48a3-84f3-f392642a8167', tool_call_id='call_WrgOt7EVteMgTpGOB8wpk95x', status='error')]}}
----
{'agent': {'messages': [AIMessage(content='It seems there was an error while trying to retrieve the total spending on fruits from both complete and incomplete receipts. I will attempt to process the request again.', additional_kwargs={'tool_calls': [{'id': 'call_jj9NpLSz1M4W6M3mRTst4r4t', 'function': {'arguments': '{"collection_name": "receipts", "description": "Retrieve total spending on fruits from complete receipts", "request": "total spending on fruits"}', 'name': 'agentic_retriever_data'}, 'type': 'function'}, {'id': 'call_2EIAJO8n4qH5oax8IlNVM5Yy', 'function': {'arguments': '{"collection_name": "non-receipts", "description": "Retrieve total spending on fruits from incomplete receipts", "request": "total spending on fruits"}', 'name': 'agentic_retriever_data'}, 'type': 'function'}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 128, 'prompt_tokens': 1524, 'total_tokens': 1652, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 1024}}, 'model_name': 'gpt-4o-mini-2024-07-18', 'system_fingerprint': 'fp_709714d124', 'finish_reason': 'tool_calls', 'logprobs': None}, id='run-7bb7bfeb-4230-4041-84c6-609363a0c6d1-0', tool_calls=[{'name': 'agentic_retriever_data', 'args': {'collection_name': 'receipts', 'description': 'Retrieve total spending on fruits from complete receipts', 'request': 'total spending on fruits'}, 'id': 'call_jj9NpLSz1M4W6M3mRTst4r4t', 'type': 'tool_call'}, {'name': 'agentic_retriever_data', 'args': {'collection_name': 'non-receipts', 'description': 'Retrieve total spending on fruits from incomplete receipts', 'request': 'total spending on fruits'}, 'id': 'call_2EIAJO8n4qH5oax8IlNVM5Yy', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1524, 'output_tokens': 128, 'total_tokens': 1652, 'input_token_details': {'audio': 0, 'cache_read': 1024}, 'output_token_details': {'audio': 0, 'reasoning': 0}})]}}
----
{'tools': {'messages': [ToolMessage(content='["Documents retrieved: ", []]', name='agentic_retriever_data', id='acc22bdb-d354-4964-b89a-354cdecd7a61', tool_call_id='call_jj9NpLSz1M4W6M3mRTst4r4t'), ToolMessage(content='Error: OutputParserException(\'Failed to parse FindQueryFormat from completion {"collection": "non-receipts", "filter_query": {"category": "fruits"}, "projection": {"total_spending": {"$sum": "$amount"}}}. Got: 1 validation error for FindQueryFormat\\nprojection.total_spending\\n  Input should be a valid integer [type=int_type, input_value={\\\'$sum\\\': \\\'$amount\\\'}, input_type=dict]\\n    For further information visit https://errors.pydantic.dev/2.10/v/int_type\\nFor troubleshooting, visit: https://python.langchain.com/docs/troubleshooting/errors/OUTPUT_PARSING_FAILURE \')\n Please fix your mistakes.', name='agentic_retriever_data', id='6f3a4eb0-7835-4705-957f-4acc8ea67688', tool_call_id='call_2EIAJO8n4qH5oax8IlNVM5Yy', status='error')]}}
----
{'agent': {'messages': [AIMessage(content='It appears that there are no complete receipts available for fruits, and there was also an error while trying to retrieve data from incomplete receipts. Unfortunately, I am unable to provide the total spending on fruits at this moment. If you have any other requests or need assistance with something else, please let me know!', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 63, 'prompt_tokens': 1829, 'total_tokens': 1892, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 1536}}, 'model_name': 'gpt-4o-mini-2024-07-18', 'system_fingerprint': 'fp_709714d124', 'finish_reason': 'stop', 'logprobs': None}, id='run-68c2a823-030b-4598-804d-f73eeb4d4851-0', usage_metadata={'input_tokens': 1829, 'output_tokens': 63, 'total_tokens': 1892, 'input_token_details': {'audio': 0, 'cache_read': 1536}, 'output_token_details': {'audio': 0, 'reasoning': 0}})]}}
----
Total Tokens: 6846
Prompt Tokens: 6293
Completion Tokens: 553
Total Cost (USD): $0.00108375
