{'agent': {'messages': [AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_pKK2hPzQxcWTdsDc7QyrkueI', 'function': {'arguments': '{"type":"function"}', 'name': 'querying_db_blocks'}, 'type': 'function'}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 17, 'prompt_tokens': 722, 'total_tokens': 739, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-4o-2024-08-06', 'system_fingerprint': 'fp_eb9dce56a8', 'finish_reason': 'tool_calls', 'logprobs': None}, id='run-11e69d49-b9d7-43ee-a15b-6fcff63ca36d-0', tool_calls=[{'name': 'querying_db_blocks', 'args': {'type': 'function'}, 'id': 'call_pKK2hPzQxcWTdsDc7QyrkueI', 'type': 'tool_call'}], usage_metadata={'input_tokens': 722, 'output_tokens': 17, 'total_tokens': 739, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}})]}}
----
{'tools': {'messages': [ToolMessage(content='["function list: ", [{"name": "get_periodical_cost", "description": "This query is used to retrieve total cost by given period.\\nCollections choices:  \\"receipts\\" for complete data or \\"non-receipts\\" for incomplete data, which was previously provided by user    \\nFormat date args: 2022-02-09 (year-month-day)\\n\\nArgs:    \\ncollection_name: str\\nstart_date: str\\nend_date: str\\nuser: str\\n\\n"}, {"name": "sum_two_numbers", "description": "This query is used to calculate the sum\\n\\nArgs:    \\na: float\\nb: float\\n"}, {"name": "get_total_cost_by_shop", "description": "This query is used to retrieve the total cost of purchases made at a specific shop.\\n    \\nArgs:\\n    collection_name: str - Name of the collection to query (\'receipts\' or \'non-receipts\')\\n    shop_name: str - Name of the shop to filter by\\n    user: str, optional - Username to filter results for a specific user\\n    \\nReturns:\\n    float - The total cost of all receipts from the specified shop"}]]', name='querying_db_blocks', id='03e3a462-e46d-47e5-955e-86a5cd677e7c', tool_call_id='call_pKK2hPzQxcWTdsDc7QyrkueI')]}}
----
{'agent': {'messages': [AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_EASFB0kfiCyBuoGq85d7R6TM', 'function': {'arguments': '{"mode":"add"}', 'name': 'cache_file_read'}, 'type': 'function'}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 16, 'prompt_tokens': 1003, 'total_tokens': 1019, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-4o-2024-08-06', 'system_fingerprint': 'fp_eb9dce56a8', 'finish_reason': 'tool_calls', 'logprobs': None}, id='run-3a6aea7b-7875-46e2-a21f-3daa2f29bf59-0', tool_calls=[{'name': 'cache_file_read', 'args': {'mode': 'add'}, 'id': 'call_EASFB0kfiCyBuoGq85d7R6TM', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1003, 'output_tokens': 16, 'total_tokens': 1019, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}})]}}
----
{'tools': {'messages': [ToolMessage(content='data_extracted: {\'yearly_cost\': {\'name\': \'yearly_cost\', \'description\': \'result of total amount of spending per current year\', \'value\': 45.34, \'args\': \'\', \'function\': \'get_receipts_info\', \'update\': \'daily\', \'display\': 0}, \'monthly_cost\': {\'name\': \'monthly_cost\', \'description\': \'result of  total amount of spending last 2 months\', \'value\': 45.34, \'args\': \'\', \'function\': \'get_receipts_info\', \'update\': \'daily\', \'display\': 0}, \'daily_cost\': {\'name\': \'daily_cost\', \'description\': \'result of total amount of spending today\', \'value\': 5, \'args\': \'(2,3)\', \'function\': \'sum_two_numbers\', \'update\': \'never\', \'display\': 1}, \'first_2_days_previous_month_cost\': {\'name\': \'first_2_days_previous_month_cost\', \'description\': \'result of total amount of spending first 2 days of the previous month\', \'value\': 0, \'args\': \'receipts\', \'function\': \'get_periodical_cost\', \'update\': \'never\', \'display\': 0}, \'weekly_cost\': {\'name\': \'weekly_cost\', \'description\': \'calculates total amount of spending for the current week\', \'value\': 0, \'args\': "(\'receipts\', \'2025-02-22\', \'2025-02-28\', \'Giorgio\')", \'function\': \'get_periodical_cost\', \'update\': \'daily\', \'display\': 1}, \'total_spending_mega_image\': {\'name\': \'total_spending_mega_image\', \'description\': \'calculates total spending at Mega Image\', \'value\': 90.68, \'args\': "(\'receipts\', \'Mega Image\', \'Giorgio\')", \'function\': \'get_total_cost_by_shop\', \'update\': \'daily\', \'display\': 1}}', name='cache_file_read', id='8a42674b-df2f-4657-9176-c3fc87adaf7a', tool_call_id='call_EASFB0kfiCyBuoGq85d7R6TM')]}}
----
{'agent': {'messages': [AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_dkgJ5prj98v143ZUcR2AkVjB', 'function': {'arguments': '{"mode":"add"}', 'name': 'cache_file_write'}, 'type': 'function'}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 16, 'prompt_tokens': 1444, 'total_tokens': 1460, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-4o-2024-08-06', 'system_fingerprint': 'fp_eb9dce56a8', 'finish_reason': 'tool_calls', 'logprobs': None}, id='run-ca6bed36-7d08-4a2c-b160-f8dc5faa3ca8-0', tool_calls=[{'name': 'cache_file_write', 'args': {'mode': 'add'}, 'id': 'call_dkgJ5prj98v143ZUcR2AkVjB', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1444, 'output_tokens': 16, 'total_tokens': 1460, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}})]}}
----
{'tools': {'messages': [ToolMessage(content="Error: 1 validation error for cache_file_write\ndata_extracted\n  Field required [type=missing, input_value={'mode': 'add'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.10/v/missing\n Please fix your mistakes.", name='cache_file_write', id='cb6321a6-bd87-4a5b-a3a8-35a874554d21', tool_call_id='call_dkgJ5prj98v143ZUcR2AkVjB', status='error')]}}
----
{'agent': {'messages': [AIMessage(content='It seems I made an error while trying to add the new item to the cache file. Let me correct that.', additional_kwargs={'tool_calls': [{'id': 'call_xlfVGch2oDHmemD2O816Z6MO', 'function': {'arguments': '{"mode":"add","data_extracted":{"total_spending_auchan":{"name":"total_spending_auchan","description":"calculates total spending at Auchan","value":0,"args":"(\'receipts\', \'Auchan\', \'Giorgio\')","function":"get_total_cost_by_shop","update":"daily","display":1}}}', 'name': 'cache_file_write'}, 'type': 'function'}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 108, 'prompt_tokens': 1528, 'total_tokens': 1636, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 1408}}, 'model_name': 'gpt-4o-2024-08-06', 'system_fingerprint': 'fp_eb9dce56a8', 'finish_reason': 'tool_calls', 'logprobs': None}, id='run-4a6af140-062f-48bd-930d-00e17ab8bfb5-0', tool_calls=[{'name': 'cache_file_write', 'args': {'mode': 'add', 'data_extracted': {'total_spending_auchan': {'name': 'total_spending_auchan', 'description': 'calculates total spending at Auchan', 'value': 0, 'args': "('receipts', 'Auchan', 'Giorgio')", 'function': 'get_total_cost_by_shop', 'update': 'daily', 'display': 1}}}, 'id': 'call_xlfVGch2oDHmemD2O816Z6MO', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1528, 'output_tokens': 108, 'total_tokens': 1636, 'input_token_details': {'audio': 0, 'cache_read': 1408}, 'output_token_details': {'audio': 0, 'reasoning': 0}})]}}
----
{'tools': {'messages': [ToolMessage(content='Successfully', name='cache_file_write', id='cd703540-62fa-4c2d-bc55-08b89f99caa2', tool_call_id='call_xlfVGch2oDHmemD2O816Z6MO')]}}
----
{'agent': {'messages': [AIMessage(content="I have added the request to calculate the total spending at Auchan to the cache file. It will be updated daily. Now, let's retrieve the total spending from Auchan for you.", additional_kwargs={'tool_calls': [{'id': 'call_pwdKzYeY9Cus4Mbk5yn7cHjF', 'function': {'arguments': '{"type":"function"}', 'name': 'querying_db_blocks'}, 'type': 'function'}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 56, 'prompt_tokens': 1647, 'total_tokens': 1703, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 1536}}, 'model_name': 'gpt-4o-2024-08-06', 'system_fingerprint': 'fp_eb9dce56a8', 'finish_reason': 'tool_calls', 'logprobs': None}, id='run-3b40304b-e3dc-431b-a114-e30cdc5a276a-0', tool_calls=[{'name': 'querying_db_blocks', 'args': {'type': 'function'}, 'id': 'call_pwdKzYeY9Cus4Mbk5yn7cHjF', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1647, 'output_tokens': 56, 'total_tokens': 1703, 'input_token_details': {'audio': 0, 'cache_read': 1536}, 'output_token_details': {'audio': 0, 'reasoning': 0}})]}}
----
{'tools': {'messages': [ToolMessage(content='["function list: ", [{"name": "get_periodical_cost", "description": "This query is used to retrieve total cost by given period.\\nCollections choices:  \\"receipts\\" for complete data or \\"non-receipts\\" for incomplete data, which was previously provided by user    \\nFormat date args: 2022-02-09 (year-month-day)\\n\\nArgs:    \\ncollection_name: str\\nstart_date: str\\nend_date: str\\nuser: str\\n\\n"}, {"name": "sum_two_numbers", "description": "This query is used to calculate the sum\\n\\nArgs:    \\na: float\\nb: float\\n"}, {"name": "get_total_cost_by_shop", "description": "This query is used to retrieve the total cost of purchases made at a specific shop.\\n    \\nArgs:\\n    collection_name: str - Name of the collection to query (\'receipts\' or \'non-receipts\')\\n    shop_name: str - Name of the shop to filter by\\n    user: str, optional - Username to filter results for a specific user\\n    \\nReturns:\\n    float - The total cost of all receipts from the specified shop"}]]', name='querying_db_blocks', id='4e0c327c-3d12-47e1-ad0b-c77d05f7fdca', tool_call_id='call_pwdKzYeY9Cus4Mbk5yn7cHjF')]}}
----
{'agent': {'messages': [AIMessage(content='I have successfully added the request to calculate the total spending at Auchan to the cache file, and it will be updated daily. However, I am currently unable to retrieve the actual data from the database. Please try again later.', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 48, 'prompt_tokens': 1969, 'total_tokens': 2017, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 1664}}, 'model_name': 'gpt-4o-2024-08-06', 'system_fingerprint': 'fp_eb9dce56a8', 'finish_reason': 'stop', 'logprobs': None}, id='run-5bd481ff-b751-4931-a6eb-0dfe7d19735f-0', usage_metadata={'input_tokens': 1969, 'output_tokens': 48, 'total_tokens': 2017, 'input_token_details': {'audio': 0, 'cache_read': 1664}, 'output_token_details': {'audio': 0, 'reasoning': 0}})]}}
----
