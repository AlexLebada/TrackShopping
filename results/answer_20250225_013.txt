{'agent': {'messages': [AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_j4ws7EsJvq90dGiA6V1mZi74', 'function': {'arguments': '{}', 'name': 'querying_collections'}, 'type': 'function'}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 13, 'prompt_tokens': 695, 'total_tokens': 708, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-4o-2024-08-06', 'system_fingerprint': 'fp_eb9dce56a8', 'finish_reason': 'tool_calls', 'logprobs': None}, id='run-2c3b6f26-9dc6-4e6d-b300-18b7ae4c37f6-0', tool_calls=[{'name': 'querying_collections', 'args': {}, 'id': 'call_j4ws7EsJvq90dGiA6V1mZi74', 'type': 'tool_call'}], usage_metadata={'input_tokens': 695, 'output_tokens': 13, 'total_tokens': 708, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}})]}}
----
{'tools': {'messages': [ToolMessage(content='["Collection list: ", [{"name": "users", "description": "Collection with user information.\\nHas the following keys, with values format and type:\\nuser: as str\\ninfo: details given like email etc, as str\\nscope: for what user wants to use this app, as str\\nregister_date: as str "}, {"name": "receipts", "description": "Collection with user\'s complete receipts, with main informations extracted.\\nHas the following keys, with values format and type:\\nuser: as str\\ndate(format: 2023-10-05): as str\\nfruits(product format:name-quantity-unit-price unit-total price), as a list of string with products \\nvegetables(same format and type as fruits)\\nshop_place: store/market where bought from, as str\\ndocument_id: id of the raw file from which this document has been extracted, as a string\\ntotal_cost: total amount of the receipt(includes also other products), as int"}, {"name": "non-receipts", "description": "Collection with user\'s incomplete receipts/other formats, with main informations extracted.\\nHas the following keys, with values format and type:\\nuser: as str\\ndate(format: 2023-10-05): as str\\nfruits(product format:name-quantity-unit-price unit-total price), as a list of string with products \\nvegetables(same format and type as fruits)\\nshop_place: store/market where bought from, as str\\ndocument_id: id of the raw file from which this document has been extracted, as a string\\ntotal_cost: total amount of the receipt(includes also other products), as int"}]]', name='querying_collections', id='99a881bd-bc18-4f6c-bee9-474209fade07', tool_call_id='call_j4ws7EsJvq90dGiA6V1mZi74')]}}
----
{'agent': {'messages': [AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_NTDMivb1nC7O9B4lOueqbP6Y', 'function': {'arguments': '{"collection_name": "receipts", "description": "Retrieve all spending by Giorgio", "request": "return all the spending made by user Giorgio"}', 'name': 'agentic_retriever_data'}, 'type': 'function'}, {'id': 'call_kUyrvdtjWelktbJNA2GUWFXN', 'function': {'arguments': '{"collection_name": "non-receipts", "description": "Retrieve all spending by Giorgio", "request": "return all the spending made by user Giorgio"}', 'name': 'agentic_retriever_data'}, 'type': 'function'}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 97, 'prompt_tokens': 1073, 'total_tokens': 1170, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-4o-2024-08-06', 'system_fingerprint': 'fp_eb9dce56a8', 'finish_reason': 'tool_calls', 'logprobs': None}, id='run-b15849a6-0457-4cf7-8c6f-63bd0695ae45-0', tool_calls=[{'name': 'agentic_retriever_data', 'args': {'collection_name': 'receipts', 'description': 'Retrieve all spending by Giorgio', 'request': 'return all the spending made by user Giorgio'}, 'id': 'call_NTDMivb1nC7O9B4lOueqbP6Y', 'type': 'tool_call'}, {'name': 'agentic_retriever_data', 'args': {'collection_name': 'non-receipts', 'description': 'Retrieve all spending by Giorgio', 'request': 'return all the spending made by user Giorgio'}, 'id': 'call_kUyrvdtjWelktbJNA2GUWFXN', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1073, 'output_tokens': 97, 'total_tokens': 1170, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}})]}}
----
{'tools': {'messages': [ToolMessage(content="('Documents retrieved: ', [{'_id': ObjectId('67afbf4cce8159cfc325e716'), 'user': 'Giorgio', 'date': '2024-10-10', 'fruits': ['MANDARIN-0.814-KG-9.22-7.51', 'PUNGA VERDE-0.12-buc-0.12-0.12', 'FM MARCU-1.000-BUC-8.39-8.39'], 'vegetables': ['ARDEI-0.212-KG-11.69-2.54', 'CEAPA-0.500-KG-3.99-1.99', 'TARHON-0.120-buc-3.75-0.12'], 'shop_place': 'Mega Image', 'document_id': 'test_img.jpg', 'total_cost': 45.34}, {'_id': ObjectId('67afcc2cff554af0a759c52b'), 'user': 'Giorgio', 'date': '2025-01-05', 'fruits': ['Mandarine-0.814-kg-9.12-7.51', 'Punga verde-0.12-BUC-2.54-2.48', 'Punga verde-0.12-BUC-2.54-2.48'], 'vegetables': ['Ardei-0.212-kg-11.69-2.47', 'Banan-0.212-kg-9.99-2.12'], 'shop_place': 'Lidl', 'document_id': '67afcc29ff554af0a759c529', 'total_cost': 45.34}, {'_id': ObjectId('67afd47ffaab0ac45fb17c20'), 'user': 'Giorgio', 'date': '2023-10-05', 'fruits': ['bananas'], 'vegetables': [], 'shop_place': 'Lidl', 'document_id': '67afd47efaab0ac45fb17c1e', 'total_cost': 20.0}, {'_id': ObjectId('67afd90cfca1e136978dc102'), 'user': 'Giorgio', 'date': '2023-12-12', 'fruits': ['Mandarine', 'Punga verde', 'Punga verde'], 'vegetables': ['Ardei', 'Banan'], 'shop_place': 'Mega Image', 'document_id': '67afd900fca1e136978dc100', 'total_cost': 45.34}, {'_id': ObjectId('67b3a765e5d447c393972868'), 'user': 'Giorgio', 'date': '2023-10-01', 'fruits': [], 'vegetables': [], 'shop_place': 'LIDL', 'document_id': '67b3a763e5d447c393972866', 'total_cost': 23.0}])", name='agentic_retriever_data', id='2978329e-2380-4566-a6e1-f425313e3b63', tool_call_id='call_NTDMivb1nC7O9B4lOueqbP6Y'), ToolMessage(content='["Documents retrieved: ", []]', name='agentic_retriever_data', id='c6d272ce-064f-4571-8bb7-3ceb6129fbdb', tool_call_id='call_kUyrvdtjWelktbJNA2GUWFXN')]}}
----
{'agent': {'messages': [AIMessage(content='Giorgio has spent a total of 179.02 across various receipts. Here are the details:\n\n1. **Date:** 2024-10-10\n   - **Shop:** Mega Image\n   - **Total Cost:** 45.34\n\n2. **Date:** 2025-01-05\n   - **Shop:** Lidl\n   - **Total Cost:** 45.34\n\n3. **Date:** 2023-10-05\n   - **Shop:** Lidl\n   - **Total Cost:** 20.00\n\n4. **Date:** 2023-12-12\n   - **Shop:** Mega Image\n   - **Total Cost:** 45.34\n\n5. **Date:** 2023-10-01\n   - **Shop:** LIDL\n   - **Total Cost:** 23.00\n\nThese amounts are based on the complete receipts available in the system.', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 194, 'prompt_tokens': 1834, 'total_tokens': 2028, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 1152}}, 'model_name': 'gpt-4o-2024-08-06', 'system_fingerprint': 'fp_eb9dce56a8', 'finish_reason': 'stop', 'logprobs': None}, id='run-ab9da0a6-f37b-47a6-914c-6926138aeeb6-0', usage_metadata={'input_tokens': 1834, 'output_tokens': 194, 'total_tokens': 2028, 'input_token_details': {'audio': 0, 'cache_read': 1152}, 'output_token_details': {'audio': 0, 'reasoning': 0}})]}}
----
Total Tokens: 4748
Prompt Tokens: 4189
Completion Tokens: 559
Total Cost (USD): $0.0146225
